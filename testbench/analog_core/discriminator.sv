/////////////////////////////////////////////////////////////////
// File Name: discriminator.sv
// Engineer:  Carl Grace (crgrace@lbl.gov)
// Description: SystemVerilog model of LARPIX discriminator
//
//              output is high is (signal > threshold)
//              threshold is generated by a 8-bit global DAC word 
//              and 5-bit pixel trim dac word
//
///////////////////////////////////////////////////////////////////

module discriminator 
    #(parameter VDDA = 1.8,
    parameter VOFFSET = 0.470)
    (output logic hit,                        // discriminator output bit
    input real signal_r,              // input signal
    input logic [7:0] threshold_global,   // threshold DAC setting
    input logic [4:0] pixel_trim_dac // threshold trim
    );

real threshold_r, global_lsb_r, trim_lsb_r;

// output assignment
always_comb begin
    hit = (signal_r > threshold_r) ? 1'b1 : 1'b0;
end // always

// dac model
always @(*) begin
    global_lsb_r = VDDA/256; // global LSB ~ 7mV nominal
    trim_lsb_r = 0.05/32; // trim has 50 mV range
    threshold_r = VOFFSET + threshold_global*global_lsb_r 
                    + pixel_trim_dac*trim_lsb_r;
end // always

endmodule
